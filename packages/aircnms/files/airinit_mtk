#!/bin/sh /etc/rc.common

USE_PROCD=1

START=96
STOP=01

NAME=airinit

LED_SCRIPT=/usr/sbin/air_led_state.sh
SSID_SCRIPT=/usr/sbin/air_ssid_check.sh

start_service() {

	# -------------------------
	# Check scripts
	# -------------------------
	for s in "$LED_SCRIPT" "$SSID_SCRIPT"; do
		if [ ! -x "$s" ]; then
			logger -t "$NAME" "Script $s not found or not executable"
			return 1
		fi
	done

	logger -t "$NAME" "Starting LED daemon and SSID config"

	# ==================================================
	# Instance 1: LED daemon (long running)
	# ==================================================
	procd_open_instance
	procd_set_param command "$LED_SCRIPT"
	procd_set_param respawn 3600 5 5
	procd_set_param stdout 1
	procd_set_param stderr 1
	procd_close_instance


	# ==================================================
	# Instance 2: SSID config (one-shot)
	# ==================================================
	procd_open_instance
	procd_set_param command "$SSID_SCRIPT"
	procd_set_param stdout 1
	procd_set_param stderr 1
	procd_close_instance
}

stop_service() {

	logger -t "$NAME" "Stopping services"

	# Turn off LEDs (only affects LED script logic)
	for led in system wlan2g wlan5g; do
		[ -w "/sys/class/leds/$led/brightness" ] && echo 0 > "/sys/class/leds/$led/brightness"
	done
}
